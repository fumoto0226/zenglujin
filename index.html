<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            user-select: none;
            -webkit-user-select: none;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "ÂæÆËΩØÈõÖÈªë", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* Animations */
        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInLeft {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .animate-slide-right { animation: slideInRight 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }
        .animate-slide-left { animation: slideInLeft 0.4s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        @keyframes fadeInZoom {
            from { transform: scale(0.95); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes fadeOutZoom {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.95); opacity: 0; }
        }
        
        .window-enter { animation: fadeInZoom 0.2s ease-out forwards; }
        /* Speed up closing animation to 0.1s */
        .window-exit { animation: fadeOutZoom 0.1s ease-in forwards; }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { height: 6px; width: 6px; background-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar-track { background-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(0, 0, 0, 0.2); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: rgba(0, 0, 0, 0.3); }
        
        /* Hide scrollbar for clean UI but allow scroll */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Hide video options (three-dots menu), download & PiP buttons (WebKit-based browsers) */
        video::-webkit-media-controls-overflow-button { display: none !important; }
        video::-webkit-media-controls-download-button { display: none !important; }
        video::-internal-media-controls-download-button { display: none !important; }
        video::-webkit-media-controls-picture-in-picture-button { display: none !important; }

        .video-play-btn:hover {
            background: rgba(255, 255, 255, 0.95);
            border-color: rgba(255, 255, 255, 0.95);
        }

        .video-play-btn:hover .video-play-icon {
            color: rgba(0, 0, 0, 0.9);
        }

        .video-play-icon {
            transform: translateX(-1px) scale(1.12);
        }
    </style>
<link rel="stylesheet" href="/index.css">
</head>
<body class="bg-[#e3e3e3] w-screen h-screen relative overflow-hidden">

    <!-- Mobile Warning Overlay -->
    <div id="mobile-warning" class="absolute inset-0 z-[100] bg-[#e3e3e3] flex flex-col items-center justify-center p-8 text-center hidden">
        <div class="mb-4 max-w-xl space-y-4">
            <div>
                <h1 class="text-2xl font-bold text-neutral-800 mb-1">Mobile Not Supported</h1>
                <p class="text-neutral-600 text-lg">This website is not currently supported on mobile devices. Please access it from a desktop computer for the best experience.</p>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-neutral-800 mb-1">ÊöÇ‰∏çÊîØÊåÅÊâãÊú∫ËÆøÈóÆ</h1>
                <p class="text-neutral-600 text-lg">Êú¨ÁΩëÁ´ôÊöÇ‰∏çÊîØÊåÅÊâãÊú∫ËÆæÂ§áÊü•ÁúãÔºåËØ∑Áî®ÁîµËÑëËÆøÈóÆ‰ª•Ëé∑ÂæóÊúÄ‰Ω≥‰ΩìÈ™å„ÄÇ</p>
            </div>
            <div>
                <h1 class="text-2xl font-bold text-neutral-800 mb-1">„É¢„Éê„Ç§„É´ÈùûÂØæÂøú</h1>
                <p class="text-neutral-600 text-lg">„Åì„ÅÆ„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÅØÁèæÂú®„É¢„Éê„Ç§„É´„Éá„Éê„Ç§„Çπ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÊúÄÈ´ò„ÅÆ‰ΩìÈ®ì„ÇíÂæó„Çã„Å´„ÅØ„ÄÅ„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„Ç≥„É≥„Éî„É•„Éº„Çø„Éº„Åã„Çâ„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
            </div>
        </div>
        <p class="text-sm text-neutral-500 mt-8">¬© 2026 zenglujin. All Rights Reserved.</p>
    </div>

    <!-- Layer 1: Desktop Icons -->
    <div id="desktop-layer" class="absolute inset-0 z-10 p-8 pt-24 flex flex-col flex-wrap content-start items-start gap-6" onclick="deselectDesktop()">
        <!-- Injected by JS -->
    </div>

    <!-- Layer 2: Footer -->
    <div id="footer-layer" class="absolute inset-0 z-10 pointer-events-none">
        <!-- Injected by JS -->
    </div>

    <!-- Layer 3: Top Bar (UI) -->
    <div id="ui-layer" class="absolute inset-0 z-20 pointer-events-none">
        <!-- Injected by JS -->
    </div>

    <!-- Layer 4: Window Overlay -->
    <div id="window-layer" class="absolute inset-0 z-30 pointer-events-none flex items-center justify-center p-4 sm:p-12">
        <!-- Injected by JS -->
    </div>

    <script>
        // --- DATA ---
        const TRANSLATIONS = {
            en: {
                websites: "Websites",
                videos: "Videos",
                photos: "Gallery",
                icons: "Icon Library",
                contact: "Contact.txt",
                label_type: "Type",
                label_platform: "Platform",
                label_tech: "Language",
                created: "Created",
                openSite: "Open Website",
                preview: "Preview",
                showMore: "Show More",
                showLess: "Show Less",
                info: "Details",
                tech_japanese: "Japanese",
                tech_en_zh: "English, Chinese",
                tech_en_ja_zh: "English, Japanese, Chinese",
                
                project0_name: "FontCraft",
                project0_desc: "A website that allows anyone to create an English font in 5 minutes without any barriers.",
                type_tool: "Web Tool",
                project1_name: "QingYan Studio",
                project1_desc: "This is a portfolio website created for QingYan Studio.",
                type_studio: "Studio Portfolio",
                project2_name: "mm's SHINJUKU",
                project2_desc: "This is an information gathering website introducing Shinjuku from an alien's perspective.",
                type_personal: "School Assignment",
                project3_name: "Cocoon Tower",
                project3_desc: "Website introducing Cocoon Tower in Shinjuku.",
                type_concept: "Concept / Design",
                type_commercial: "Commercial",
                
                category_other: "Other",
                project5_name: "WowoPopo",
                project5_desc: "A song-guessing search tool using iTurns audio samples, available only as a WeChat Mini Program.",
                type_tool_game: "Tool / Game",
                platform_pc: "PC",
                platform_pc_mobile: "PC, Mobile",
                platform_wechat: "WeChat Mini Program",
                tech_zh: "Chinese",
                
                text_kind: "Plain Text Document",
                contact_content: "Name: Zeng Lujin\nEmail: cenglujin@gmail.com\nPhone: (+86) 18081345866 / (+81) 07076592037\nWechat: kururugi111\n\nFeel free to reach out for collaborations!",
                mobile_warning_title: "Mobile Not Supported",
                mobile_warning_message: "This website is not currently supported on mobile devices. Please access it from a desktop computer for the best experience.",
                
                video_type_commercial: "Commercial",
                video_type_personal: "Personal",
                
                secret_empty: "Nothing here",
                secret_pasword_prompt: "Enter Pasword",
                secret_pasword_placeholder: "Pasword",
                secret_pasword_cancel: "Cancel",
                secret_pasword_confirm: "Confirm",
                secret_pasword_wrong: "Incorrect pasword",
                secret_pasword_correct: "Pasword Correct",
                secret_pasword_unlock: "Unlock",
                
                hidden_reward: "üí∞ 1 USD",
                hidden_claim: "Show this screenshot to claim"
            },
            zh: {
                websites: "ÁΩëÁ´ô",
                videos: "ËßÜÈ¢ë",
                photos: "ÂõæÂÉè",
                icons: "ÂõæÊ†áÂ∫ì",
                contact: "ËÅîÁ≥ªÊñπÂºè.txt",
                label_type: "Á±ªÂûã",
                label_platform: "Âπ≥Âè∞",
                label_tech: "ËØ≠Ë®Ä",
                created: "ÂàõÂª∫Êó•Êúü",
                openSite: "ËÆøÈóÆÁΩëÁ´ô",
                preview: "È¢ÑËßà",
                showMore: "Â±ïÂºÄ‰ø°ÊÅØ",
                showLess: "Êî∂Ëµ∑‰ø°ÊÅØ",
                info: "‰ø°ÊÅØ",
                tech_japanese: "Êó•ËØ≠",
                tech_en_zh: "Ëã±ËØ≠Ôºå‰∏≠Êñá",
                tech_en_ja_zh: "Ëã±ËØ≠ÔºåÊó•ËØ≠Ôºå‰∏≠Êñá",
                
                project0_name: "FontCraft",
                project0_desc: "Êó†Èó®Êßõ5ÂàÜÈíüÂÅöÊàê‰∏Ä‰∏™Ëã±ÊñáÂ≠ó‰ΩìÁöÑÁΩëÁ´ô„ÄÇ",
                type_tool: "Â∑•ÂÖ∑ÁΩëÁ´ô",
                project1_name: "QingYan Studio",
                project1_desc: "ËøôÊòØ‰∏∫QingYan StudioÂà∂‰ΩúÁöÑÁî®‰∫é‰ΩúÂìÅÂ±ïÁ§∫ÁöÑÁΩëÁ´ô„ÄÇ",
                type_studio: "Â∑•‰ΩúÂÆ§‰ΩúÂìÅÁΩëÁ´ô",
                project2_name: "mm's SHINJUKU",
                project2_desc: "ËøôÊòØ‰∏Ä‰∏™ÈÄöËøáÂ§ñÊòü‰∫∫ÁöÑËßÜËßíÊù•‰ªãÁªçÊñ∞ÂÆøÁöÑÊÉÖÊä•Êî∂ÈõÜÁΩëÁ´ô„ÄÇ",
                type_personal: "Â≠¶Ê†°‰Ωú‰∏ö",
                project3_name: "Cocoon Tower",
                project3_desc: "‰ªãÁªç‰Ωç‰∫éÊñ∞ÂÆøÁöÑcocoon towerÂ§ßÊ•ºÁöÑÁΩëÁ´ô„ÄÇ",
                type_concept: "Ê¶ÇÂøµËÆæËÆ°",
                type_commercial: "ÂïÜ‰∏öÈ°πÁõÆ",
                
                category_other: "ÂÖ∂‰ªñ",
                project5_name: "Á™ùÁ™ùÂù°Âù°",
                project5_desc: "‰ΩøÁî®‰∫ÜiTurnsËØïÂê¨Èü≥Ê∫êÁöÑÊêúÁ¥¢ÁåúÊ≠åÂ∑•ÂÖ∑ÔºåÂè™ËÉΩÂú®ÂæÆ‰ø°Â∞èÁ®ãÂ∫è‰ΩøÁî®„ÄÇ",
                type_tool_game: "Â∑•ÂÖ∑/Ê∏∏Êàè",
                platform_pc: "ÁîµËÑë",
                platform_pc_mobile: "ÁîµËÑëÔºåÊâãÊú∫",
                platform_wechat: "ÂæÆ‰ø°Â∞èÁ®ãÂ∫è",
                tech_zh: "‰∏≠Êñá",
                
                text_kind: "Á∫ØÊñáÊú¨Êñá‰ª∂",
                contact_content: "ÂßìÂêç: ÊõæÈ∫ìÁëæ\nÈÇÆÁÆ±: cenglujin@gmail.com\nÁîµËØù: (+86) 18081345866 / (+81) 07076592037\nÂæÆ‰ø°: kururugi111 Ôºà‰ºòÂÖàÂæÆ‰ø°ËÅîÁ≥ªÔºåÂÖ∂‰ªñÊñπÂºèÂèØËÉΩËÅîÁ≥ª‰∏çÂà∞„ÄÇÔºâ\n\nÊ¨¢ËøéÈöèÊó∂ËÅîÁ≥ªÂêà‰ΩúÔºÅ",
                mobile_warning_title: "ÊöÇ‰∏çÊîØÊåÅÊâãÊú∫ËÆøÈóÆ",
                mobile_warning_message: "Êú¨ÁΩëÁ´ôÊöÇ‰∏çÊîØÊåÅÊâãÊú∫ËÆæÂ§áÊü•ÁúãÔºåËØ∑Áî®ÁîµËÑëËÆøÈóÆ‰ª•Ëé∑ÂæóÊúÄ‰Ω≥‰ΩìÈ™å„ÄÇ",
                
                video_type_commercial: "ÂïÜ‰∏ö",
                video_type_personal: "‰∏™‰∫∫",
                
                secret_empty: "ËøôÈáå‰ªÄ‰πàÈÉΩÊ≤°Êúâ",
                secret_pasword_prompt: "ËæìÂÖ•ÂØÜÁ†Å",
                secret_pasword_placeholder: "ÂØÜÁ†Å",
                secret_pasword_cancel: "ÂèñÊ∂à",
                secret_pasword_confirm: "Á°ÆËÆ§",
                secret_pasword_wrong: "ÂØÜÁ†ÅÈîôËØØ",
                secret_pasword_correct: "ÂØÜÁ†ÅÊ≠£Á°Æ",
                secret_pasword_unlock: "Ëß£ÈîÅ",
                
                hidden_reward: "üí∞ 10 CNY",
                hidden_claim: "ÂèØÂá≠Êà™ÂõæÊâæÊàëÈ¢ÜÂèñ"
            },
            ja: {
                websites: "Web„Çµ„Ç§„Éà",
                videos: "„Éì„Éá„Ç™",
                photos: "„ÇÆ„É£„É©„É™„Éº",
                icons: "„Ç¢„Ç§„Ç≥„É≥Á¥†Êùê",
                contact: "ÈÄ£Áµ°ÂÖà.txt",
                label_type: "„Çø„Ç§„Éó",
                label_platform: "ÂØæÂøúÁí∞Â¢É",
                label_tech: "Ë®ÄË™û",
                created: "‰ΩúÊàêÊó•",
                openSite: "„Çµ„Ç§„Éà„ÇíÈñã„Åè",
                preview: "„Éó„É¨„Éì„É•„Éº",
                showMore: "Ë©≥Á¥∞„ÇíË°®Á§∫",
                showLess: "Ë©≥Á¥∞„ÇíÈö†„Åô",
                info: "ÊÉÖÂ†±",
                tech_japanese: "Êó•Êú¨Ë™û",
                tech_en_zh: "Ëã±Ë™û„ÄÅ‰∏≠ÂõΩË™û",
                tech_en_ja_zh: "Ëã±Ë™û„ÄÅÊó•Êú¨Ë™û„ÄÅ‰∏≠ÂõΩË™û",
                
                project0_name: "FontCraft",
                project0_desc: "Ë™∞„Åß„ÇÇ5ÂàÜ„ÅßËã±Ë™û„Éï„Ç©„É≥„Éà„Çí‰ΩúÊàê„Åß„Åç„Çã„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„Åß„Åô„ÄÇ",
                type_tool: "„Ç¶„Çß„Éñ„ÉÑ„Éº„É´",
                project1_name: "QingYan Studio",
                project1_desc: "QingYan Studio„ÅÆ„Åü„ÇÅ„Å´Âà∂‰Ωú„Åï„Çå„Åü„Éù„Éº„Éà„Éï„Ç©„É™„Ç™„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„Åß„Åô„ÄÇ",
                type_studio: "„Çπ„Çø„Ç∏„Ç™„Éù„Éº„Éà„Éï„Ç©„É™„Ç™",
                project2_name: "mm's SHINJUKU",
                project2_desc: "ÂÆáÂÆô‰∫∫„ÅÆË¶ñÁÇπ„Åã„ÇâÊñ∞ÂÆø„ÅÆÊÉÖÂ†±„ÇíÁ¥π‰ªã„Åô„ÇãÊÉÖÂ†±ÂèéÈõÜ„Çµ„Ç§„Éà„Åß„Åô„ÄÇ",
                type_personal: "Â≠¶Ê†°Ë™≤È°å",
                project3_name: "Cocoon Tower",
                project3_desc: "Êñ∞ÂÆø„Å´„ÅÇ„Çã„Ç≥„ÇØ„Éº„É≥„Çø„ÉØ„Éº„Éì„É´„ÇíÁ¥π‰ªã„Åô„Çã„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÄÇ",
                type_concept: "„Ç≥„É≥„Çª„Éó„Éà",
                type_commercial: "ÂïÜÁî®„Éó„É≠„Ç∏„Çß„ÇØ„Éà",
                
                category_other: "„Åù„ÅÆ‰ªñ",
                project5_name: "WowoPopo",
                project5_desc: "iTurns„ÅÆË©¶ËÅ¥Èü≥Ê∫ê„Çí‰ΩøÁî®„Åó„ÅüÊõ≤ÂΩì„Å¶Ê§úÁ¥¢„ÉÑ„Éº„É´„ÄÇWeChat„Éü„Éã„Éó„É≠„Ç∞„É©„É†„Åß„ÅÆ„ÅøÂà©Áî®ÂèØËÉΩ„ÄÇ",
                type_tool_game: "„ÉÑ„Éº„É´/„Ç≤„Éº„É†",
                platform_pc: "PC",
                platform_pc_mobile: "PC„ÄÅ„É¢„Éê„Ç§„É´",
                platform_wechat: "WeChat„Éü„Éã„Éó„É≠„Ç∞„É©„É†",
                tech_zh: "‰∏≠ÂõΩË™û",
                
                text_kind: "„Éó„É¨„Éº„É≥„ÉÜ„Ç≠„Çπ„Éà",
                contact_content: "ÂêçÂâç: ÊõæÈ∫ìÁëæ\n„É°„Éº„É´: cenglujin@gmail.com\nÈõªË©±: (+86) 18081345866 / (+81) 07076592037\nWechat: kururugi111\n\n„Åä‰ªï‰∫ã„ÅÆ„Åî‰æùÈ†º„ÅäÂæÖ„Å°„Åó„Å¶„Åä„Çä„Åæ„ÅôÔºÅ",
                mobile_warning_title: "„É¢„Éê„Ç§„É´ÈùûÂØæÂøú",
                mobile_warning_message: "„Åì„ÅÆ„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÅØÁèæÂú®„É¢„Éê„Ç§„É´„Éá„Éê„Ç§„Çπ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì„ÄÇÊúÄÈ´ò„ÅÆ‰ΩìÈ®ì„ÇíÂæó„Çã„Å´„ÅØ„ÄÅ„Éá„Çπ„ÇØ„Éà„ÉÉ„Éó„Ç≥„É≥„Éî„É•„Éº„Çø„Éº„Åã„Çâ„Ç¢„ÇØ„Çª„Çπ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                
                video_type_commercial: "ÂïÜÊ•≠",
                video_type_personal: "ÂÄã‰∫∫",
                
                secret_empty: "„Åì„Åì„Å´„ÅØ‰Ωï„ÇÇ„Å™„ÅÑ",
                secret_pasword_prompt: "„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ",
                secret_pasword_placeholder: "„Éë„Çπ„ÉØ„Éº„Éâ",
                secret_pasword_cancel: "„Ç≠„É£„É≥„Çª„É´",
                secret_pasword_confirm: "Á¢∫Ë™ç",
                secret_pasword_wrong: "„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô",
                secret_pasword_correct: "„Éë„Çπ„ÉØ„Éº„ÉâÊ≠£„Åó„ÅÑ",
                secret_pasword_unlock: "Ëß£Èô§",
                
                hidden_reward: "üí∞ 100 JPY",
                hidden_claim: "„Åì„ÅÆ„Çπ„ÇØ„É™„Éº„É≥„Ç∑„Éß„ÉÉ„Éà„ÅßÂèó„ÅëÂèñ„Çå„Åæ„Åô"
            }
        };

        const WEBSITE_FILES = [
            { id: 'p0', nameKey: 'project0_name', descKey: 'project0_desc', typeKey: 'type_tool', platform: 'platform_pc_mobile', tech: 'tech_en_ja_zh', category: 'websites', images: ['img/website/FontCraft.jpg', 'img/website/FontCraft-2.jpg', 'img/website/FontCraft-3.jpg', 'img/website/FontCraft-4.jpg'], url: '#', date: '2026.02' },
            { id: 'p1', nameKey: 'project1_name', descKey: 'project1_desc', typeKey: 'type_studio', platform: 'platform_pc_mobile', tech: 'tech_en_zh', category: 'websites', images: ['img/website/QingYan-Studio.jpg', 'img/website/QingYan-Studio-2.jpg', 'img/website/QingYan-Studio-3.jpg', 'img/website/QingYan-Studio-4.jpg', 'img/website/QingYan-Studio-5.jpg', 'img/website/QingYan-Studio-6.jpg'], url: 'https://fumoto0226.github.io/qzhuphoto/', date: '2026.02' },
            { id: 'p2', nameKey: 'project2_name', descKey: 'project2_desc', typeKey: 'type_personal', platform: 'platform_pc', tech: 'tech_japanese', category: 'websites', images: ['img/website/mms.jpg', 'img/website/mms-2.jpg', 'img/website/mms-3.jpg', 'img/website/mms-4.jpg', 'img/website/mms-5.jpg', 'img/website/mms-6.jpg'], url: 'https://fumoto0226.github.io/mms/', date: '2025.12' },
            { id: 'p3', nameKey: 'project3_name', descKey: 'project3_desc', typeKey: 'type_personal', platform: 'platform_pc', tech: 'tech_japanese', category: 'websites', images: ['img/website/cocoon.jpg', 'img/website/cocoon-2.jpg', 'img/website/cocoon-3.jpg', 'img/website/cocoon-4.jpg'], url: 'https://fumoto0226.github.io/cocoon-web2/', date: '2025.07' },
            { id: 'p5', nameKey: 'project5_name', descKey: 'project5_desc', typeKey: 'type_tool_game', platform: 'platform_wechat', tech: 'tech_zh', category: 'other', images: ['img/website/Wowopopo.jpg', 'img/website/Wowopopo-2.jpg'], noUrl: true, date: '2026.01' }
        ];

        const VIDEO_FILES = [
            { id: 'v1', title_en: 'Puff ‚Äì Token of Love', title_zh: 'puff-token of love', title_ja: 'Puff ‚Äì Token of Love', typeKey: 'video_type_commercial', date: '2025.2', thumbnail: 'img/movie/puff-token of love.jpg', videoUrl: 'img/movie/puff-token of love.mp4', aspectRatio: '16:9' },
            { id: 'v2', title_en: 'Jun Xiaobao ‚Äì Jia Nailiang', title_zh: 'ËèåÂ∞èÂÆù-Ë¥æ‰πÉ‰∫Æ', title_ja: 'Jun Xiaobao ‚Äì Jia Nailiang', typeKey: 'video_type_commercial', date: '2023.1', thumbnail: 'img/movie/ËèåÂ∞èÂÆù-Ë¥æ‰πÉ‰∫Æ.jpg', videoUrl: 'img/movie/ËèåÂ∞èÂÆù-Ë¥æ‰πÉ‰∫Æ.mp4', aspectRatio: '16:9' },
            { id: 'v3', title_en: 'Tmall Captain', title_zh: 'Â§©Áå´Ëà∞Èïø', title_ja: 'Tmall Captain', typeKey: 'video_type_commercial', date: '2022.12', thumbnail: '', videoUrl: 'img/movie/Â§©Áå´Ëà∞Èïø.mp4', aspectRatio: '16:9' },
            { id: 'v4', title_en: 'Hip-hop Girl ‚Äì QQ Music Interlude', title_zh: 'ÈªëÊÄïÂ•≥Â≠©qqÈü≥‰πêËøáÂú∫', title_ja: 'Hip-hop Girl ‚Äì QQ Music Interlude', typeKey: 'video_type_commercial', date: '2021.7', thumbnail: '', videoUrl: 'img/movie/ÈªëÊÄïÂ•≥Â≠©qqÈü≥‰πêËøáÂú∫.mp4', aspectRatio: '16:9' },
            { id: 'v5', title_en: 'Design Class Quick Cut', title_zh: 'ËÆæËÆ°ËØæÂø´Ââ™', title_ja: 'Design Class Quick Cut', typeKey: 'video_type_commercial', date: '2021.1', thumbnail: 'img/movie/ËÆæËÆ°ËØæÂø´Ââ™.jpg', videoUrl: 'img/movie/ËÆæËÆ°ËØæÂø´Ââ™.mp4', aspectRatio: '16:9' },
            { id: 'v6', title_en: 'Werewolf Boxer', title_zh: 'Âõ∞ÂÖΩ', title_ja: 'Werewolf Boxer', typeKey: 'video_type_personal', date: '2020.5', thumbnail: 'img/movie/Âõ∞ÂÖΩ.jpg', videoUrl: 'img/movie/Âõ∞ÂÖΩ.mp4', aspectRatio: '16:9' },
            { id: 'v7', title_en: 'School Memories', title_zh: 'ÊØçÊ†°ËÆ∞ÂøÜ', title_ja: 'School Memories', typeKey: 'video_type_personal', date: '2019.5', thumbnail: '', videoUrl: 'img/movie/ÊØçÊ†°ËÆ∞ÂøÜ.mp4', aspectRatio: '16:9' },
            { id: 'v8', title_en: 'DanShen', title_zh: 'ËõãÁîü', title_ja: 'DanShen', typeKey: 'video_type_personal', date: '2018.12', thumbnail: '', videoUrl: 'img/movie/ËõãÁîü.mp4', aspectRatio: '16:9' },
        ];

        const PHOTO_FILES = [
            { id: 'ph1', url: 'https://images.unsplash.com/photo-1470071459604-3b5ec3a7fe05?q=80&w=800&auto=format&fit=crop', title: 'Mountain' },
            { id: 'ph2', url: 'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?q=80&w=800&auto=format&fit=crop', title: 'Forest' },
            { id: 'ph3', url: 'https://images.unsplash.com/photo-1472214103451-9374bd1c798e?q=80&w=800&auto=format&fit=crop', title: 'Valley' },
            { id: 'ph4', url: 'https://images.unsplash.com/photo-1501785888041-af3ef285b470?q=80&w=800&auto=format&fit=crop', title: 'Lake' },
            { id: 'ph5', url: 'https://images.unsplash.com/photo-1470770841072-f978cf4d019e?q=80&w=800&auto=format&fit=crop', title: 'Field' },
            { id: 'ph6', url: 'https://images.unsplash.com/photo-1433086966358-54859d0ed716?q=80&w=800&auto=format&fit=crop', title: 'Waterfall' },
            { id: 'ph7', url: 'https://images.unsplash.com/photo-1502082553048-f009c37129b9?q=80&w=800&auto=format&fit=crop', title: 'Tree' },
            { id: 'ph8', url: 'https://images.unsplash.com/photo-1465146344425-f00d5f5c8f07?q=80&w=800&auto=format&fit=crop', title: 'Ocean' },
        ];

        // --- STATE MANAGEMENT ---
        const state = {
            lang: localStorage.getItem('preferredLanguage') || 'en',
            selectedDesktopId: null,
            openFolderId: null,
            selectedFileId: WEBSITE_FILES[0].id,
            currentImageIndex: 0, // Track current preview image index for websites
            selectedVideoId: VIDEO_FILES[0].id,
            selectedPhotoId: PHOTO_FILES[0].id,
            galleryViewMode: 'single', // 'single' or 'grid'
            isDetailsExpanded: false,
            langDropdownOpen: false,
            slideDirection: 'right',
            isClosing: false, // Track closing state
            showHidden: false, // Track hidden files visibility
            playingVideoId: null, // Track which video is playing
            preloadedImages: {}, // Cache for preloaded images
            hiddenFolderSelected: false // Track hidden folder selection in secret
        };

        // --- IMAGE PRELOADING ---
        function preloadImages(imageUrls) {
            imageUrls.forEach(url => {
                if (!state.preloadedImages[url]) {
                    const img = new Image();
                    img.src = url;
                    state.preloadedImages[url] = img;
                }
            });
        }

        // Preload all website images on page load
        function preloadAllWebsiteImages() {
            const allImages = [];
            WEBSITE_FILES.forEach(file => {
                if (file.images) {
                    allImages.push(...file.images);
                } else if (file.image) {
                    allImages.push(file.image);
                }
            });
            preloadImages(allImages);
        }

        // --- HELPER ---
        function getVideoTitle(video) {
            if (state.lang === 'zh') return video.title_zh;
            if (state.lang === 'ja') return video.title_ja;
            return video.title_en;
        }

        function safeRenderIcons(rootElement) {
            if (window.lucide) {
                if(rootElement) {
                    lucide.createIcons({ root: rootElement });
                } else {
                    lucide.createIcons();
                }
            }
        }

        // --- CORE FUNCTIONS ---
        
        function t(key) {
            return TRANSLATIONS[state.lang][key] || key;
        }

        // Main entry point - Updates all layers
        function render() {
            renderTopBar();
            renderDesktop();
            renderFooter();
            renderWindow();
        }

        // Layer 1: Desktop
        function renderDesktop() {
            const container = document.getElementById('desktop-layer');
            const icons = [
                { id: 'websites', icon: 'folder', label: t('websites'), color: '#5ea0d6', fill: '#7dc0f5' },
                { id: 'videos', icon: 'folder', label: t('videos'), color: '#5ea0d6', fill: '#7dc0f5' },
                { id: 'contact', icon: 'file-text', label: t('contact'), color: '#525252', fill: 'white' }
            ];

            // Add photos folder if state.showHidden is true
            if (state.showHidden) {
                icons.push({ 
                    id: 'photos', 
                    icon: 'folder', 
                    label: t('photos'), 
                    color: '#5ea0d6', 
                    fill: '#7dc0f5',
                    isHidden: true
                });
                icons.push({ 
                    id: 'secret', 
                    icon: 'folder-lock', 
                    label: '.secret', 
                    color: '#9ca3af', 
                    fill: '#d1d5db',
                    isHidden: true,
                    needsPasword: true
                });
            }

            container.innerHTML = icons.map(icon => `
                <div 
                    onclick="selectDesktop(event, '${icon.id}')"
                    ondblclick="${icon.needsPasword ? 'openSecretFolder()' : `openFolder('${icon.id}')`}"
                    class="flex flex-col items-center justify-start w-28 p-3 rounded-lg cursor-pointer transition-all duration-100 group ${state.selectedDesktopId === icon.id ? 'bg-blue-300/40 border border-blue-400/30 backdrop-blur-sm' : 'hover:bg-black/5 border border-transparent'} ${icon.isHidden ? 'opacity-60 hover:opacity-100' : ''}"
                >
                    <div class="mb-1 relative">
                        <i data-lucide="${icon.icon}" width="${icon.id === 'secret' ? 48 : icon.icon === 'folder' || icon.icon === 'folder-lock' ? 56 : 48}" height="${icon.id === 'secret' ? 48 : icon.icon === 'folder' || icon.icon === 'folder-lock' ? 56 : 56}" stroke-width="1" class="${icon.id === 'contact' ? 'text-neutral-600' : icon.isHidden ? 'text-neutral-500' : 'text-[#5ea0d6]'}" ${icon.id === 'contact' ? 'fill="white"' : icon.isHidden ? 'fill="#e5e7eb"' : 'fill="#7dc0f5"'}></i>
                    </div>
                    <span class="text-xs text-center font-medium px-2 py-0.5 rounded leading-tight select-none ${state.selectedDesktopId === icon.id ? 'text-neutral-900' : 'text-neutral-700'}">
                        ${icon.label}
                    </span>
                </div>
            `).join('');
            
            safeRenderIcons(container);
        }

        // Layer 2: Footer
        function renderFooter() {
            const container = document.getElementById('footer-layer');
            container.innerHTML = `
                <div class="absolute bottom-6 left-8 pointer-events-none select-none">
                    <p class="text-[10px] text-neutral-400/60 font-medium tracking-wide">
                        Ctrl + Shift + .
                    </p>
                </div>
                <div class="absolute bottom-6 right-8 pointer-events-none select-none text-right">
                    <div class="mb-1 leading-snug" style="color:#4E4E4E;">
                        <p class="text-[10px] font-medium tracking-wide">${({
                            zh: '‰∏™‰∫∫‰ΩúÂìÅÈõÜ/È°πÁõÆËÆ∞ÂΩïÔºåÁÇπÂáªÊñá‰ª∂Â§πÊµèËßà„ÄÇ',
                            ja: 'ÂÄã‰∫∫„Éù„Éº„Éà„Éï„Ç©„É™„Ç™/„Éó„É≠„Ç∏„Çß„ÇØ„ÉàË®òÈå≤„Åß„Åô„ÄÇ„Éï„Ç©„É´„ÉÄ„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶„ÅîË¶ß„Åè„Å†„Åï„ÅÑ„ÄÇ',
                            en: 'Portfolio / Project archive. Click folders to explore.'
                        }[state.lang] || 'Portfolio / Project archive. Click folders to explore.')}</p>
                    </div>
                    <p class="text-[10px] text-neutral-400/80 font-medium tracking-widest uppercase">
                        ¬© 2026 zenglujin. All Rights Reserved.
                    </p>
                </div>
            `;
        }

        // Layer 3: Top Bar
        function renderTopBar() {
            const container = document.getElementById('ui-layer');
            const langLabel = { en: 'English', zh: '‰∏≠Êñá', ja: 'Êó•Êú¨Ë™û' }[state.lang];
            
            let dropdownHTML = '';
            if (state.langDropdownOpen) {
                dropdownHTML = `
                    <div class="absolute right-0 mt-2 w-32 bg-white/95 backdrop-blur-xl rounded-xl shadow-xl border border-white/20 py-2 overflow-hidden z-[60] pointer-events-auto">
                        ${['en', 'zh', 'ja'].map(l => `
                            <button onclick="changeLang('${l}')" class="w-full text-left px-4 py-2 text-sm flex items-center justify-between ${state.lang === l ? 'bg-neutral-100 font-bold' : 'hover:bg-neutral-50 ' + (l === 'en' ? '' : 'font-medium')}">
                                <span>${{en:'English', zh:'‰∏≠Êñá', ja:'Êó•Êú¨Ë™û'}[l]}</span>
                                ${state.lang === l ? '<div class="w-1.5 h-1.5 rounded-full bg-neutral-800"></div>' : ''}
                            </button>
                        `).join('')}
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="absolute top-0 left-0 w-full p-6 flex justify-between items-start z-30 pointer-events-none">
                    <div></div>
                    <div class="pointer-events-auto relative">
                        <button onclick="toggleLangDropdown()" class="flex items-center gap-2 px-4 py-2 bg-white/50 backdrop-blur-md rounded-full text-sm font-medium text-neutral-800 hover:bg-white/80 transition-all shadow-sm border border-white/40">
                            <i data-lucide="globe" width="16"></i>
                            <span>${langLabel}</span>
                        </button>
                        ${dropdownHTML}
                    </div>
                </div>
            `;
            
            safeRenderIcons(container);
        }

        // Layer 4: Window (Incremental Update Logic)
        function renderWindow() {
            const layer = document.getElementById('window-layer');
            
            // If closed and not animating close, empty it
            if (!state.openFolderId && !state.isClosing) {
                layer.innerHTML = '';
                return;
            }

            const folderName = state.openFolderId === 'websites' ? t('websites') : 
                               state.openFolderId === 'videos' ? t('videos') :
                               state.openFolderId === 'photos' ? t('photos') : 
                               state.openFolderId === 'secret' ? '.secret' :
                               t('contact');
            const iconType = state.openFolderId === 'contact' ? 'file-text' : 
                             state.openFolderId === 'videos' ? 'film' :
                             state.openFolderId === 'photos' ? 'image' : 
                             state.openFolderId === 'secret' ? 'lock' : 'folder';

            const existingWindow = document.getElementById('active-window');

            if (!existingWindow) {
                // Initial Render (create frame)
                // Note: Added z-50 relative to active-window so it sits above the z-40 overlay
                // CRITICAL FIX: Added pointer-events-auto to the background overlay so it captures clicks
                const windowSize = state.openFolderId === 'secret' ? 'max-w-4xl max-h-[600px]' : 'max-w-6xl max-h-[800px]';
                layer.innerHTML = `
                    <div class="absolute inset-0 z-40 pointer-events-auto" onclick="closeWindow()"></div>
                    <div id="active-window" class="relative z-50 pointer-events-auto bg-white w-full h-full ${windowSize} rounded-xl shadow-2xl flex flex-col overflow-hidden border border-neutral-300 window-enter">
                        <div class="h-12 bg-[#f1f1f1] border-b border-neutral-300 flex items-center justify-between px-4 shrink-0" id="window-header"></div>
                        <div id="window-content" class="flex-1 flex overflow-hidden bg-white relative"></div>
                    </div>
                `;
            }

            // Update Header
            const header = document.getElementById('window-header');
            if(header) {
                header.innerHTML = `
                    <div class="flex items-center gap-2 group">
                        <button onclick="closeWindow()" class="w-3.5 h-3.5 rounded-full bg-[#ff5f57] border border-[#e0443e] flex items-center justify-center hover:opacity-80">
                            <i data-lucide="x" width="8" stroke-width="3" class="opacity-0 group-hover:opacity-100 text-black/60"></i>
                        </button>
                        <!-- Updated: dots are now always visible with bg-black/20 -->
                        <button class="w-3.5 h-3.5 rounded-full bg-[#febc2e] border border-[#d89e24] flex items-center justify-center cursor-default">
                             <div class="w-1 h-1 rounded-full bg-black/20"></div>
                        </button>
                        <button class="w-3.5 h-3.5 rounded-full bg-[#28c840] border border-[#1aab29] flex items-center justify-center cursor-default">
                             <div class="w-1 h-1 rounded-full bg-black/20"></div>
                        </button>
                    </div>
                    <div class="flex items-center gap-2 text-neutral-700 font-semibold absolute left-1/2 -translate-x-1/2">
                        <i data-lucide="${iconType}" width="16" class="text-neutral-500"></i>
                        <span class="text-sm">${folderName}</span>
                    </div>
                    <div class="w-14 flex justify-end">
                        ${state.openFolderId === 'photos' && state.galleryViewMode === 'single' ? `
                            <button onclick="setGalleryMode('grid')" class="p-1.5 rounded-md hover:bg-neutral-200 text-neutral-600" title="Grid View">
                                <i data-lucide="layout-grid" width="18"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
                safeRenderIcons(header);
            }

            // Update Content
            const contentContainer = document.getElementById('window-content');
            
            // Save scrolls
            const sidebarScroll = document.getElementById('sidebar-scroll');
            const savedSidebarScroll = sidebarScroll ? sidebarScroll.scrollTop : 0;
            const detailScroll = document.getElementById('detail-scroll');
            const savedDetailScroll = detailScroll ? detailScroll.scrollTop : 0;
            const gridScroll = document.getElementById('grid-scroll');
            const savedGridScroll = gridScroll ? gridScroll.scrollTop : 0;

            let newContent = '';
            if (state.openFolderId === 'websites') newContent = getWebsitesContent();
            else if (state.openFolderId === 'videos') newContent = getVideosContent();
            else if (state.openFolderId === 'photos') newContent = getPhotosContent();
            else if (state.openFolderId === 'contact') newContent = getContactContent();
            else if (state.openFolderId === 'secret') newContent = getSecretContent();

            if(contentContainer) {
                contentContainer.innerHTML = newContent;
                // Re-render icons in the entire window after content update
                const activeWindow = document.getElementById('active-window');
                if (activeWindow) {
                    safeRenderIcons(activeWindow);
                }
            }

            // Restore scrolls
            const newSidebarScroll = document.getElementById('sidebar-scroll');
            if (newSidebarScroll) newSidebarScroll.scrollTop = savedSidebarScroll;
            const newDetailScroll = document.getElementById('detail-scroll');
            if (newDetailScroll) newDetailScroll.scrollTop = savedDetailScroll;
            const newGridScroll = document.getElementById('grid-scroll');
            if (newGridScroll) newGridScroll.scrollTop = savedGridScroll;

            // Attach listeners
            const thumbStrip = document.getElementById('thumbnail-strip');
            if (thumbStrip) {
                thumbStrip.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    thumbStrip.scrollLeft += e.deltaY;
                });
            }
            
            // Final icon render to ensure all icons are displayed correctly
            setTimeout(() => {
                const activeWindow = document.getElementById('active-window');
                if (activeWindow) {
                    safeRenderIcons(activeWindow);
                }
            }, 0);
        }

        // --- CONTENT GENERATORS ---

        function getWebsitesContent() {
            const selectedFile = WEBSITE_FILES.find(f => f.id === state.selectedFileId) || WEBSITE_FILES[0];
            const images = selectedFile.images || [selectedFile.image];
            const hasMultipleImages = images.length > 1;
            const currentImage = images[state.currentImageIndex] || images[0];
            
            // Calculate classes for the sliding animation
            // Image wrapper classes for animation
            // Expanded: bottom-45% (gives 45% screen to details, 55% to image)
            // Collapsed: top-0 bottom-60px (full height minus bottom header)
            const imageWrapperClass = state.isDetailsExpanded ? 'bottom-[45%]' : 'bottom-[60px]';
            
            const translateClass = state.isDetailsExpanded ? 'translate-y-0' : 'translate-y-[calc(100%-60px)]';
            const arrowIcon = state.isDetailsExpanded ? 'chevron-down' : 'chevron-up';
            const toggleText = state.isDetailsExpanded ? t('showLess') : t('showMore');

            return `
                <div id="sidebar-scroll" class="w-64 bg-[#f5f5f5]/80 backdrop-blur-xl border-r border-neutral-200 flex flex-col overflow-y-auto pt-2 shrink-0">
                    <div class="px-3 py-2 text-[10px] font-bold text-neutral-400 uppercase tracking-wider">${t('websites')}</div>
                    ${WEBSITE_FILES.filter(f => f.category === 'websites').map(file => `
                        <div onclick="selectFile('${file.id}')" class="mx-2 px-3 py-2 rounded-md flex items-center gap-3 cursor-pointer text-sm transition-colors mb-1 ${state.selectedFileId === file.id ? 'bg-blue-500 text-white shadow-sm' : 'text-neutral-700 hover:bg-neutral-200/60'}">
                            <i data-lucide="globe" width="16" class="${state.selectedFileId === file.id ? 'text-blue-100' : 'text-neutral-500'}"></i>
                            <span class="truncate font-medium">${t(file.nameKey)}</span>
                        </div>
                    `).join('')}
                    <div class="px-3 py-2 mt-2 text-[10px] font-bold text-neutral-400 uppercase tracking-wider">${t('category_other')}</div>
                    ${WEBSITE_FILES.filter(f => f.category === 'other').map(file => `
                        <div onclick="selectFile('${file.id}')" class="mx-2 px-3 py-2 rounded-md flex items-center gap-3 cursor-pointer text-sm transition-colors mb-1 ${state.selectedFileId === file.id ? 'bg-blue-500 text-white shadow-sm' : 'text-neutral-700 hover:bg-neutral-200/60'}">
                            <i data-lucide="globe" width="16" class="${state.selectedFileId === file.id ? 'text-blue-100' : 'text-neutral-500'}"></i>
                            <span class="truncate font-medium">${t(file.nameKey)}</span>
                        </div>
                    `).join('')}
                </div>

                <div class="flex-1 bg-white relative h-full overflow-hidden min-w-0 group/container">
                    <!-- Image Area with Animation -->
                    <div id="website-image-wrapper" class="absolute top-0 left-0 right-0 ${imageWrapperClass} transition-all duration-500 ease-[cubic-bezier(0.19,1,0.22,1)] overflow-hidden">
                        <!-- Unified Structure for both states -->
                        <div class="h-full w-full flex items-center justify-center p-8 bg-neutral-50/30 relative">
                            <!-- Previous Image Thumbnail (absolute positioned, only visible when expanded) -->
                            ${hasMultipleImages && state.currentImageIndex > 0 && state.isDetailsExpanded ? `
                                <div onclick="prevWebsiteImage()" class="absolute left-8 top-1/2 -translate-y-1/2 w-[120px] h-[calc(100%-64px)] rounded-lg border border-neutral-200 overflow-hidden cursor-pointer hover:scale-105 transition-all opacity-60 hover:opacity-100 z-0" style="background-image: url('${images[state.currentImageIndex - 1]}'); background-size: cover; background-position: right center;">
                                </div>
                            ` : ''}
                            
                            <!-- Main Image (always centered) -->
                            <div class="h-full w-auto aspect-video max-w-full rounded-lg border border-neutral-200 relative group overflow-hidden z-10">
                                <div class="absolute inset-0 flex transition-transform duration-500 ease-out" style="transform: translateX(-${state.currentImageIndex * 100}%)">
                                    ${images.map((img, idx) => `
                                        <div class="w-full h-full shrink-0" style="background-image: url('${img}'); background-size: cover; background-position: center;">
                                        </div>
                                    `).join('')}
                                </div>
                                
                                ${hasMultipleImages ? `
                                    <div class="absolute bottom-4 right-4 bg-black/60 text-white text-xs px-2 py-1 rounded-full">
                                        ${state.currentImageIndex + 1} / ${images.length}
                                    </div>
                                ` : ''}
                                
                                <!-- Navigation Arrows (only show when collapsed) -->
                                ${hasMultipleImages && !state.isDetailsExpanded ? `
                                    ${state.currentImageIndex > 0 ? `
                                        <button onclick="prevWebsiteImage()" class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/20 backdrop-blur-md border border-white/50 hover:bg-white/90 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all shadow-lg z-10 group/btn">
                                            <i data-lucide="chevron-left" width="28" class="text-white group-hover/btn:text-black transition-colors"></i>
                                        </button>
                                    ` : ''}
                                    ${state.currentImageIndex < images.length - 1 ? `
                                        <button onclick="nextWebsiteImage()" class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/20 backdrop-blur-md border border-white/50 hover:bg-white/90 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all shadow-lg z-10 group/btn">
                                            <i data-lucide="chevron-right" width="28" class="text-white group-hover/btn:text-black transition-colors"></i>
                                        </button>
                                    ` : ''}
                                ` : ''}
                                
                                <!-- Open Site Button -->
                                ${!selectedFile.noUrl ? `
                                <div class="absolute inset-0 bg-black/10 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center pointer-events-none">
                                    <a href="${selectedFile.url}" target="_blank" class="bg-white/20 backdrop-blur-md border border-white/50 text-white px-4 py-2 rounded-full text-sm font-medium hover:bg-white hover:text-neutral-900 transition-colors flex items-center gap-2 pointer-events-auto">
                                    ${t('openSite')} <i data-lucide="external-link" width="14"></i>
                                </a>
                            </div>
                                ` : ''}
                            </div>
                            
                            <!-- Next Image Thumbnail (absolute positioned, only visible when expanded) -->
                            ${hasMultipleImages && state.currentImageIndex < images.length - 1 && state.isDetailsExpanded ? `
                                <div onclick="nextWebsiteImage()" class="absolute right-8 top-1/2 -translate-y-1/2 w-[120px] h-[calc(100%-64px)] rounded-lg border border-neutral-200 overflow-hidden cursor-pointer hover:scale-105 transition-all opacity-60 hover:opacity-100 z-0" style="background-image: url('${images[state.currentImageIndex + 1]}'); background-size: cover; background-position: left center;">
                                </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Detail Panel Overlay -->
                    <div id="detail-panel" class="absolute bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-neutral-200 transition-transform duration-500 ease-[cubic-bezier(0.19,1,0.22,1)] shadow-[0_-10px_40px_rgba(0,0,0,0.05)] ${translateClass} z-10 flex flex-col h-[45%]">
                        
                        <!-- Header -->
                        <div onclick="toggleDetails()" class="h-[60px] px-6 flex items-center justify-between cursor-pointer hover:bg-white/50 transition-colors shrink-0">
                            <h2 class="text-xl font-semibold text-neutral-900 flex items-center gap-3 truncate">
                                <i data-lucide="globe" width="24" class="text-blue-500 shrink-0"></i>
                                <span class="truncate">${t(selectedFile.nameKey)}</span>
                            </h2>
                            <button class="flex items-center gap-1 text-xs font-medium text-blue-500 bg-blue-50 px-2 py-1 rounded-full shrink-0 ml-4">
                                <span id="detail-text">${toggleText}</span>
                                <i id="detail-arrow" data-lucide="${arrowIcon}" width="14"></i>
                            </button>
                        </div>
                        
                        <!-- Content -->
                        <div class="overflow-y-auto custom-scrollbar flex-1 bg-transparent">
                            <div class="px-8 pb-10 pt-2">
                                 <div class="grid grid-cols-[80px_1fr] gap-y-3 text-sm max-w-2xl">
                                    <div class="text-neutral-400 font-medium text-right pr-4">${t('label_type')}</div>
                                    <div class="text-neutral-700">${t(selectedFile.typeKey)}</div>
                                    <div class="text-neutral-400 font-medium text-right pr-4">${t('label_platform')}</div>
                                    <div class="text-neutral-700">${t(selectedFile.platform)}</div>
                                    <div class="text-neutral-400 font-medium text-right pr-4">${t('label_tech')}</div>
                                    <div class="text-neutral-700">${t(selectedFile.tech)}</div>
                                    <div class="text-neutral-400 font-medium text-right pr-4">${t('created')}</div>
                                    <div class="text-neutral-700">${selectedFile.date}</div>
                                    <div class="text-neutral-400 font-medium text-right pr-4">${t('info')}</div>
                                    <div class="text-neutral-600 leading-relaxed">${t(selectedFile.descKey)}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getVideosContent() {
            const selectedVideo = VIDEO_FILES.find(v => v.id === state.selectedVideoId) || VIDEO_FILES[0];
            
            return `
                <div class="flex-1 bg-white p-8 overflow-y-auto custom-scrollbar">
                    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6">
                        ${VIDEO_FILES.map(video => {
                            const thumb = video.thumbnail || '';
                            return `
                            <div data-video-id="${video.id}" onclick="selectVideo('${video.id}')" ondblclick="playVideo('${video.id}')" class="group cursor-pointer flex flex-col gap-2 ${state.selectedVideoId === video.id ? 'ring-2 ring-blue-500 rounded-lg' : ''}">
                                <div class="aspect-video w-full rounded-md overflow-hidden bg-neutral-100 shadow-sm border border-neutral-200 group-hover:shadow-md transition-all relative">
                                    ${thumb ? `
                                        <img src="${thumb}" alt="${getVideoTitle(video)}" loading="lazy" class="w-full h-full object-cover" />
                                    ` : `
                                        <video preload="metadata" class="w-full h-full object-cover pointer-events-none">
                                            <source src="${video.videoUrl}#t=0.1" type="video/mp4">
                                        </video>
                                    `}

                                    <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-colors flex items-center justify-center">
                                        <button onclick="event.stopPropagation(); playVideo('${video.id}')" class="video-play-btn pointer-events-auto opacity-0 group-hover:opacity-100 transition-opacity duration-150 w-12 h-12 rounded-full bg-white/25 backdrop-blur-md border border-white/40 shadow-lg flex items-center justify-center">
                                            <svg width="26" height="26" viewBox="0 0 24 24" fill="currentColor" class="video-play-icon text-white" aria-hidden="true">
                                                <path d="M8 5v14l11-7z"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="px-1">
                                    <div class="text-sm font-medium text-neutral-900 truncate">${getVideoTitle(video)}</div>
                                    <div class="text-xs text-neutral-500 flex justify-between">
                                        <span>${t(video.typeKey)}</span>
                                        <span>${video.date}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function getPhotosContent() {
            if (state.galleryViewMode === 'grid') {
                return `
                    <div id="grid-scroll" class="flex-1 bg-white p-6 overflow-y-auto">
                        <div class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-6">
                            ${PHOTO_FILES.map(photo => `
                                <div onclick="selectPhoto('${photo.id}')" ondblclick="selectPhotoAndSwitch('${photo.id}')" class="group cursor-pointer flex flex-col gap-2 ${state.selectedPhotoId === photo.id ? 'ring-2 ring-blue-500 rounded-lg' : ''}">
                                    <div class="aspect-[4/3] w-full rounded-md overflow-hidden bg-neutral-100 shadow-sm border border-neutral-200 group-hover:shadow-md transition-all">
                                        <img src="${photo.url}" alt="${photo.title}" loading="lazy" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"/>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            const selectedPhoto = PHOTO_FILES.find(p => p.id === state.selectedPhotoId) || PHOTO_FILES[0];

            return `
                <div class="flex-1 bg-white flex flex-col overflow-hidden">
                    <div class="flex-1 bg-white flex items-center justify-center p-4 overflow-hidden relative" onwheel="handlePhotoWheel(event)">
                        <img 
                            key="${selectedPhoto.id}"
                            src="${selectedPhoto.url}" 
                            class="max-w-full max-h-full object-contain rounded-sm"
                        />
                    </div>
                    <div id="thumbnail-strip" class="h-20 bg-neutral-50 border-t border-neutral-200 p-4 flex gap-3 overflow-x-auto shrink-0 items-center custom-scrollbar">
                        ${PHOTO_FILES.map(photo => `
                            <button 
                                onclick="selectPhoto('${photo.id}')"
                                class="h-full aspect-[4/3] rounded-md overflow-hidden border-2 transition-all shrink-0 relative group ${state.selectedPhotoId === photo.id ? 'border-blue-500 shadow-md scale-105' : 'border-transparent opacity-70 hover:opacity-100 hover:scale-105'}"
                            >
                                <img src="${photo.url}" class="w-full h-full object-cover" />
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getContactContent() {
            // Process contact content to add gray color for the note
            let content = t('contact_content');
            // Replace the note with styled span
            content = content.replace(
                /Ôºà‰ºòÂÖàÂæÆ‰ø°ËÅîÁ≥ªÔºåÂÖ∂‰ªñÊñπÂºèÂèØËÉΩËÅîÁ≥ª‰∏çÂà∞„ÄÇÔºâ/g,
                '<span style="margin-left: 10px; color: #9ca3af;">Ôºà‰ºòÂÖàÂæÆ‰ø°ËÅîÁ≥ªÔºåÂÖ∂‰ªñÊñπÂºèÂèØËÉΩËÅîÁ≥ª‰∏çÂà∞„ÄÇÔºâ</span>'
            );
            
            return `
                <div class="flex-1 bg-white flex flex-col text-sm outline-none" style="font-family: 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'ÂæÆËΩØÈõÖÈªë', -apple-system, BlinkMacSystemFont, sans-serif;">
                    <div class="p-2 border-b border-neutral-100 text-xs text-neutral-400 flex items-center gap-2 font-mono">
                        <span>UTF-8</span>
                        <span class="w-px h-3 bg-neutral-200"></span>
                        <span>${t('text_kind')}</span>
                    </div>
                    <div class="flex-1 p-8 overflow-y-auto whitespace-pre-wrap leading-relaxed text-neutral-800 outline-none select-text">
${content}
                    </div>
                </div>
            `;
        }

        function getSecretContent() {
            return `
                <div class="flex-1 bg-white flex flex-col items-center justify-center text-neutral-500 gap-4 select-none relative" onclick="deselectHiddenFolder()">
                    <!-- Hidden clickable area in top right -->
                    <div 
                        onclick="selectHiddenFolder(event)"
                        ondblclick="openHiddenFolder()"
                        class="absolute top-8 right-8 w-24 h-24 cursor-pointer transition-all ${state.hiddenFolderSelected ? 'bg-blue-300/40 border-2 border-blue-400/50 rounded-lg' : ''}"
                    ></div>
                    <div class="text-center pointer-events-none">
                        <p class="text-lg font-medium">${t('secret_empty')}</p>
                    </div>
                </div>
            `;
        }

        // --- ACTIONS ---

        window.toggleLangDropdown = function() {
            state.langDropdownOpen = !state.langDropdownOpen;
            renderTopBar();
        };

        window.changeLang = function(lang) {
            state.lang = lang;
            localStorage.setItem('preferredLanguage', lang);
            state.langDropdownOpen = false;
            render(); 
        };

        window.selectDesktop = function(e, id) {
            e.stopPropagation();
            state.selectedDesktopId = id;
            renderDesktop(); 
        };

        window.deselectDesktop = function() {
            if (state.selectedDesktopId) {
                state.selectedDesktopId = null;
                renderDesktop();
            }
            if (state.langDropdownOpen) {
                state.langDropdownOpen = false;
                renderTopBar();
            }
        };

        window.openSecretFolder = function() {
            // Show custom pasword dialog
            const layer = document.getElementById('window-layer');
            layer.innerHTML = `
                <div class="absolute inset-0 z-[80] bg-black/30 backdrop-blur-sm flex items-center justify-center pointer-events-auto" onclick="closePaswordDialog(event)">
                    <div class="bg-white rounded-2xl shadow-2xl p-6 w-80 pointer-events-auto" onclick="event.stopPropagation()">
                        <h2 class="text-lg font-semibold text-neutral-800 mb-6 text-center">${t('secret_pasword_prompt')}</h2>
                        <div class="flex gap-3 justify-center mb-3">
                            <input type="text" maxlength="1" class="pasword-digit w-12 h-14 text-center text-2xl font-semibold border-2 border-neutral-300 rounded-lg focus:border-blue-500 focus:outline-none" data-index="0" />
                            <input type="text" maxlength="1" class="pasword-digit w-12 h-14 text-center text-2xl font-semibold border-2 border-neutral-300 rounded-lg focus:border-blue-500 focus:outline-none" data-index="1" />
                            <input type="text" maxlength="1" class="pasword-digit w-12 h-14 text-center text-2xl font-semibold border-2 border-neutral-300 rounded-lg focus:border-blue-500 focus:outline-none" data-index="2" />
                            <input type="text" maxlength="1" class="pasword-digit w-12 h-14 text-center text-2xl font-semibold border-2 border-neutral-300 rounded-lg focus:border-blue-500 focus:outline-none" data-index="3" />
                        </div>
                        <div id="pasword-feedback" class="text-sm text-center mb-4 h-5"></div>
                        <button id="unlock-btn" onclick="unlockSecret()" disabled class="w-full px-4 py-3 bg-neutral-200 text-neutral-400 rounded-lg font-medium transition-colors cursor-not-allowed">
                            ${t('secret_pasword_unlock')}
                        </button>
                    </div>
                </div>
            `;
            
            // Setup pasword inputs
            setTimeout(() => {
                const inputs = document.querySelectorAll('.pasword-digit');
                inputs[0].focus();
                
                inputs.forEach((input, index) => {
                    input.addEventListener('input', (e) => {
                        const value = e.target.value;
                        if (value && /^\d$/.test(value)) {
                            // Move to next input
                            if (index < 3) {
                                inputs[index + 1].focus();
                            }
                            // Check if all filled
                            checkPaswordComplete();
                        }
                    });
                    
                    input.addEventListener('keydown', (e) => {
                        if (e.key === 'Backspace' && !input.value && index > 0) {
                            inputs[index - 1].focus();
                        }
                        // Space key to unlock
                        if (e.key === ' ' || e.key === 'Spacebar') {
                            e.preventDefault();
                            const unlockBtn = document.getElementById('unlock-btn');
                            if (!unlockBtn.disabled) {
                                unlockSecret();
                            }
                        }
                    });
                    
                    input.addEventListener('paste', (e) => {
                        e.preventDefault();
                        const paste = e.clipboardData.getData('text');
                        const digits = paste.match(/\d/g);
                        if (digits) {
                            digits.slice(0, 4).forEach((digit, i) => {
                                if (inputs[i]) inputs[i].value = digit;
                            });
                            checkPaswordComplete();
                        }
                    });
                });
            }, 100);
        };

        window.checkPaswordComplete = function() {
            const inputs = document.querySelectorAll('.pasword-digit');
            const password = Array.from(inputs).map(input => input.value).join('');
            const feedback = document.getElementById('pasword-feedback');
            const unlockBtn = document.getElementById('unlock-btn');
            
            if (password.length === 4) {
                if (password === '2727') { // You found it.
                    feedback.textContent = '‚úì ' + t('secret_pasword_correct');
                    feedback.className = 'text-sm text-center mb-4 h-5 text-green-500 font-medium';
                    unlockBtn.disabled = false;
                    unlockBtn.className = 'w-full px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium transition-colors cursor-pointer';
                } else {
                    feedback.textContent = '‚úó ' + t('secret_pasword_wrong');
                    feedback.className = 'text-sm text-center mb-4 h-5 text-red-500 font-medium';
                    unlockBtn.disabled = true;
                    unlockBtn.className = 'w-full px-4 py-3 bg-neutral-200 text-neutral-400 rounded-lg font-medium transition-colors cursor-not-allowed';
                    // Clear inputs after a delay
                    setTimeout(() => {
                        inputs.forEach(input => input.value = '');
                        inputs[0].focus();
                        feedback.textContent = '';
                    }, 1000);
                }
            } else {
                feedback.textContent = '';
                unlockBtn.disabled = true;
                unlockBtn.className = 'w-full px-4 py-3 bg-neutral-200 text-neutral-400 rounded-lg font-medium transition-colors cursor-not-allowed';
            }
        };

        window.unlockSecret = function() {
            closePaswordDialog();
            // Clear hidden folder selection when opening secret folder
            state.hiddenFolderSelected = false;
            openFolder('secret');
        };

        window.closePaswordDialog = function(event) {
            if (event) event.stopPropagation();
            const layer = document.getElementById('window-layer');
            layer.innerHTML = '';
        };

        window.selectHiddenFolder = function(event) {
            event.stopPropagation();
            state.hiddenFolderSelected = true;
            renderWindow();
        };

        window.deselectHiddenFolder = function() {
            if (state.hiddenFolderSelected) {
                state.hiddenFolderSelected = false;
                renderWindow();
            }
        };

        window.openHiddenFolder = function() {
            // Show a smaller window with message
            const layer = document.getElementById('window-layer');
            const existingOverlay = layer.querySelector('.z-\\[80\\]');
            if (existingOverlay) return; // Prevent multiple overlays
            
            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 z-[90] bg-black/30 backdrop-blur-sm flex items-center justify-center pointer-events-auto';
            overlay.onclick = function(e) {
                if (e.target === overlay) {
                    overlay.remove();
                }
            };
            
            overlay.innerHTML = `
                <div class="bg-white rounded-xl shadow-2xl w-96 h-64 flex flex-col overflow-hidden pointer-events-auto" onclick="event.stopPropagation()">
                    <div class="h-10 bg-[#f1f1f1] border-b border-neutral-300 flex items-center justify-between px-4 shrink-0">
                        <div class="flex items-center gap-2">
                            <button onclick="this.closest('.z-\\\\[90\\\\]').remove()" class="w-3 h-3 rounded-full bg-[#ff5f57] border border-[#e0443e] hover:opacity-80"></button>
                            <button class="w-3 h-3 rounded-full bg-[#febc2e] border border-[#d89e24] cursor-default"></button>
                            <button class="w-3 h-3 rounded-full bg-[#28c840] border border-[#1aab29] cursor-default"></button>
                        </div>
                        <div class="flex items-center gap-2 text-neutral-600 text-sm font-medium">
                            <i data-lucide="folder" width="14"></i>
                            <span>.hidden</span>
                        </div>
                        <div class="w-14"></div>
                    </div>
                    <div class="flex-1 bg-white flex flex-col items-center justify-center gap-2" style="margin-top: -5px;">
                        <p class="text-3xl font-medium">${t('hidden_reward')}</p>
                        <p class="text-sm" style="color: rgb(215, 215, 215);">${t('hidden_claim')}</p>
                    </div>
                </div>
            `;
            
            layer.appendChild(overlay);
            safeRenderIcons(overlay);
        };

        window.openFolder = function(id) {
            // If already open, do nothing (or we could focus it)
            if (state.openFolderId === id && !state.isClosing) return;
            
            state.openFolderId = id;
            state.isClosing = false; // Reset close state

            if (id === 'websites') {
                state.selectedFileId = WEBSITE_FILES[0].id;
                // Preload all website images when opening the folder
                preloadAllWebsiteImages();
            }
            if (id === 'videos') state.selectedVideoId = VIDEO_FILES[0].id;
            if (id === 'photos') {
                state.selectedPhotoId = PHOTO_FILES[0].id;
                state.galleryViewMode = 'single';
            }
            renderWindow(); 
        };

        window.closeWindow = function() {
            const win = document.getElementById('active-window');
            if (win && !state.isClosing) {
                state.isClosing = true;
                // Add exit animation class
                win.classList.remove('window-enter');
                win.classList.add('window-exit');
                
                // Wait for animation to finish before removing from DOM
                setTimeout(() => {
                    state.openFolderId = null;
                    state.isClosing = false;
                    renderWindow();
                }, 100); // 100ms matches css animation duration (faster)
            } else if (!win) {
                state.openFolderId = null;
                renderWindow();
            }
        };

        window.selectFile = function(id) {
            state.selectedFileId = id;
            state.currentImageIndex = 0; // Reset image index when selecting a new file
            renderWindow(); 
        };

        window.selectWebsiteImage = function(index) {
            state.currentImageIndex = index;
            renderWindow();
        };

        window.nextWebsiteImage = function() {
            const selectedFile = WEBSITE_FILES.find(f => f.id === state.selectedFileId) || WEBSITE_FILES[0];
            const images = selectedFile.images || [selectedFile.image];
            if (state.currentImageIndex < images.length - 1) {
                state.currentImageIndex++;
                renderWindow();
            }
        };

        window.prevWebsiteImage = function() {
            if (state.currentImageIndex > 0) {
                state.currentImageIndex--;
                renderWindow();
            }
        };

        window.toggleDetails = function() {
            state.isDetailsExpanded = !state.isDetailsExpanded;
            
            // Use smooth animation with DOM manipulation
            const panel = document.getElementById('detail-panel');
            const arrow = document.getElementById('detail-arrow');
            const text = document.getElementById('detail-text');
            const imgWrapper = document.getElementById('website-image-wrapper');
            
            if (panel && imgWrapper) {
                if (state.isDetailsExpanded) {
                    panel.classList.remove('translate-y-[calc(100%-60px)]');
                    panel.classList.add('translate-y-0');
                        imgWrapper.classList.remove('bottom-[60px]');
                        imgWrapper.classList.add('bottom-[45%]');
                } else {
                    panel.classList.add('translate-y-[calc(100%-60px)]');
                    panel.classList.remove('translate-y-0');
                        imgWrapper.classList.add('bottom-[60px]');
                        imgWrapper.classList.remove('bottom-[45%]');
                }
                
                if (text) text.innerText = state.isDetailsExpanded ? t('showLess') : t('showMore');
                
                if (arrow) {
                    const newIcon = document.createElement('i');
                    newIcon.id = 'detail-arrow';
                    newIcon.setAttribute('width', '14');
                    newIcon.setAttribute('data-lucide', state.isDetailsExpanded ? 'chevron-down' : 'chevron-up');
                    arrow.replaceWith(newIcon);
                    if (window.lucide) lucide.createIcons({ root: newIcon.parentElement });
                }
                
                // For websites folder, update thumbnails and arrows
                if (state.openFolderId === 'websites') {
                    // Update the entire image wrapper content to show/hide thumbnails and arrows
                    setTimeout(() => {
                        const newContent = getWebsitesContent();
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = newContent;
                        const newImageWrapper = tempDiv.querySelector('#website-image-wrapper');
                        const currentImageWrapper = document.getElementById('website-image-wrapper');
                        
                        if (newImageWrapper && currentImageWrapper) {
                            // Get the container with thumbnails
                            const container = currentImageWrapper.querySelector('.relative.h-full');
                            const newContainer = newImageWrapper.querySelector('.relative.h-full');
                            
                            if (container && newContainer) {
                                container.innerHTML = newContainer.innerHTML;
                                safeRenderIcons(container);
                            }
                        }
                    }, 50);
                }
            } else {
                // Fallback
                renderWindow();
            }
        };

        window.setGalleryMode = function(mode) {
            state.galleryViewMode = mode;
            renderWindow();
        };

        window.selectPhoto = function(id) {
            const oldIndex = PHOTO_FILES.findIndex(p => p.id === state.selectedPhotoId);
            const newIndex = PHOTO_FILES.findIndex(p => p.id === id);
            state.slideDirection = newIndex > oldIndex ? 'right' : 'left';
            state.selectedPhotoId = id;
            renderWindow();
        };

        window.selectPhotoAndSwitch = function(id) {
            state.selectedPhotoId = id;
            state.galleryViewMode = 'single';
            renderWindow();
        };

        window.handlePhotoWheel = function(e) {
            if (window.wheelThrottle) return;
            window.wheelThrottle = true;
            setTimeout(() => window.wheelThrottle = false, 150);

            const currentIndex = PHOTO_FILES.findIndex(p => p.id === state.selectedPhotoId);
            let nextIndex = currentIndex;

            if (e.deltaY > 0) {
                nextIndex = (currentIndex + 1) % PHOTO_FILES.length;
                state.slideDirection = 'right';
            } else {
                nextIndex = (currentIndex - 1 + PHOTO_FILES.length) % PHOTO_FILES.length;
                state.slideDirection = 'left';
            }
            state.selectedPhotoId = PHOTO_FILES[nextIndex].id;
            renderWindow();
        };

        window.selectVideo = function(id) {
            state.selectedVideoId = id;
            
            // Update selection highlight without re-rendering all videos
            const cards = document.querySelectorAll('[data-video-id]');
            cards.forEach(card => {
                if (card.getAttribute('data-video-id') === id) {
                    card.classList.add('ring-2', 'ring-blue-500', 'rounded-lg');
                } else {
                    card.classList.remove('ring-2', 'ring-blue-500', 'rounded-lg');
                }
            });
        };

        window.playVideo = function(id) {
            const video = VIDEO_FILES.find(v => v.id === id);
            if (!video) return;
            
            state.playingVideoId = id;
            
            // Calculate width based on aspect ratio
            // Fixed height: 700px (minus 40px for header = 660px video height)
            const videoHeight = 660;
            const [width, height] = video.aspectRatio.split(':').map(Number);
            const aspectRatio = width / height;
            const calculatedWidth = Math.round(videoHeight * aspectRatio);
            
            // Create video player overlay on top of existing window
            const layer = document.getElementById('window-layer');
            const videoPlayerHTML = `
                <div class="absolute inset-0 z-[60] pointer-events-auto" data-video-backdrop="true" onclick="closeVideoPlayer()"></div>
                <div id="video-player" class="absolute inset-0 m-auto z-[70] pointer-events-auto bg-black rounded-xl shadow-2xl flex flex-col overflow-hidden border border-neutral-800 window-enter" style="width: ${calculatedWidth}px; height: 700px;">
                    <div class="h-10 bg-[#2a2a2a] border-b border-neutral-700 flex items-center justify-between px-4 shrink-0">
                        <div class="flex items-center gap-2 group">
                            <button onclick="closeVideoPlayer()" class="w-3 h-3 rounded-full bg-[#ff5f57] border border-[#e0443e] flex items-center justify-center hover:opacity-80">
                                <i data-lucide="x" width="7" stroke-width="3" class="opacity-0 group-hover:opacity-100 text-black/60"></i>
                            </button>
                            <button class="w-3 h-3 rounded-full bg-[#febc2e] border border-[#d89e24] cursor-default"></button>
                            <button class="w-3 h-3 rounded-full bg-[#28c840] border border-[#1aab29] cursor-default"></button>
                        </div>
                        <div class="text-neutral-300 font-medium text-sm">${getVideoTitle(video)}</div>
                        <div class="w-14"></div>
                    </div>
                    <div class="flex-1 bg-black flex items-center justify-center overflow-hidden">
                        <video id="active-video" controls autoplay controlsList="nodownload noplaybackrate noremoteplayback" disablepictureinpicture class="w-full h-full object-contain">
                            <source src="${video.videoUrl}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                </div>
            `;
            
            layer.insertAdjacentHTML('beforeend', videoPlayerHTML);
            safeRenderIcons(layer);
        };

        window.closeVideoPlayer = function() {
            state.playingVideoId = null;
            const video = document.getElementById('active-video');
            if (video) video.pause();
            
            const layer = document.getElementById('window-layer');
            if (layer) {
                const backdrops = layer.querySelectorAll('[data-video-backdrop="true"]');
                backdrops.forEach(el => el.remove());
                const player = document.getElementById('video-player');
                if (player) player.remove();
            }
        };

        // --- GLOBAL EVENT LISTENERS ---
        document.addEventListener('keydown', (e) => {
            // Control + Shift + . (Also support Meta/Command for Mac)
            if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === '.') {
                e.preventDefault();
                state.showHidden = !state.showHidden;
                renderDesktop();
            }
            
            // Space key handler
            if (e.key === ' ' || e.code === 'Space') {
                e.preventDefault();
                
                // If video player is open, close it
                if (state.playingVideoId) {
                    closeVideoPlayer();
                    return;
                }
                
                // If in websites folder, toggle details
                if (state.openFolderId === 'websites') {
                    toggleDetails();
                    return;
                }
                
                // If in videos folder, play selected video
                if (state.openFolderId === 'videos') {
                    playVideo(state.selectedVideoId);
                    return;
                }
                
                // If in photos folder, toggle view mode or view photo
                if (state.openFolderId === 'photos') {
                    if (state.galleryViewMode === 'single') {
                        setGalleryMode('grid');
                    } else {
                        // In grid mode, space = view photo (like double click)
                        selectPhotoAndSwitch(state.selectedPhotoId);
                    }
                    return;
                }
                
                // If in contact folder, close it
                if (state.openFolderId === 'contact') {
                    closeWindow();
                    return;
                }
                
                // Secret folder: space key is disabled (no close action)
                if (state.openFolderId === 'secret') {
                    return;
                }
                
                // If a desktop icon is selected, open it (except secret folder)
                if (state.selectedDesktopId) {
                    if (state.selectedDesktopId === 'secret') {
                        openSecretFolder();
                    } else {
                        openFolder(state.selectedDesktopId);
                    }
                }
            }
            
            // ESC key to close window or video player
            if (e.key === 'Escape') {
                e.preventDefault();
                
                // If video player is open, close it
                if (state.playingVideoId) {
                    closeVideoPlayer();
                    return;
                }
                
                // If a window is open, close it
                if (state.openFolderId) {
                    closeWindow();
                    return;
                }
            }
            
            // Arrow keys navigation
            if (e.key.startsWith('Arrow')) {
                e.preventDefault();
                
                // Desktop navigation
                if (!state.openFolderId) {
                    const icons = ['websites', 'videos', 'contact'];
                    if (state.showHidden) {
                        icons.push('photos');
                        icons.push('secret');
                    }
                    
                    let currentIndex = state.selectedDesktopId ? icons.indexOf(state.selectedDesktopId) : -1;
                    
                    if (e.key === 'ArrowDown') {
                        currentIndex = (currentIndex + 1) % icons.length;
                    } else if (e.key === 'ArrowUp') {
                        currentIndex = (currentIndex - 1 + icons.length) % icons.length;
                    } else if (e.key === 'ArrowRight') {
                        currentIndex = (currentIndex + 1) % icons.length;
                    } else if (e.key === 'ArrowLeft') {
                        currentIndex = (currentIndex - 1 + icons.length) % icons.length;
                    }
                    
                    state.selectedDesktopId = icons[currentIndex];
                    renderDesktop();
                    return;
                }
                
                // Websites folder navigation
                if (state.openFolderId === 'websites') {
                    const selectedFile = WEBSITE_FILES.find(f => f.id === state.selectedFileId) || WEBSITE_FILES[0];
                    const images = selectedFile.images || [selectedFile.image];
                    
                    if (e.key === 'ArrowUp') {
                        const currentIndex = WEBSITE_FILES.findIndex(f => f.id === state.selectedFileId);
                        if (currentIndex > 0) {
                            state.selectedFileId = WEBSITE_FILES[currentIndex - 1].id;
                            state.currentImageIndex = 0;
                            renderWindow();
                        }
                    } else if (e.key === 'ArrowDown') {
                        const currentIndex = WEBSITE_FILES.findIndex(f => f.id === state.selectedFileId);
                        if (currentIndex < WEBSITE_FILES.length - 1) {
                            state.selectedFileId = WEBSITE_FILES[currentIndex + 1].id;
                            state.currentImageIndex = 0;
                            renderWindow();
                        }
                    } else if (e.key === 'ArrowLeft' && images.length > 1) {
                        // Navigate to previous image
                        if (state.currentImageIndex > 0) {
                            state.currentImageIndex--;
                            renderWindow();
                        }
                    } else if (e.key === 'ArrowRight' && images.length > 1) {
                        // Navigate to next image
                        if (state.currentImageIndex < images.length - 1) {
                            state.currentImageIndex++;
                            renderWindow();
                        }
                    }
                    return;
                }
                
                // Videos folder navigation
                if (state.openFolderId === 'videos') {
                    const currentIndex = VIDEO_FILES.findIndex(v => v.id === state.selectedVideoId);
                    let newIndex = currentIndex;
                    
                    // Detect actual number of columns from the grid layout
                    const gridEl = document.querySelector('#window-content .grid');
                    const cols = gridEl ? getComputedStyle(gridEl).gridTemplateColumns.split(' ').length : 5;
                    
                    if (e.key === 'ArrowLeft') {
                        newIndex = (currentIndex - 1 + VIDEO_FILES.length) % VIDEO_FILES.length;
                    } else if (e.key === 'ArrowRight') {
                        newIndex = (currentIndex + 1) % VIDEO_FILES.length;
                    } else if (e.key === 'ArrowUp') {
                        newIndex = Math.max(0, currentIndex - cols);
                    } else if (e.key === 'ArrowDown') {
                        newIndex = Math.min(VIDEO_FILES.length - 1, currentIndex + cols);
                    }
                    
                    if (newIndex !== currentIndex) {
                        // Reuse selectVideo to avoid re-rendering thumbnails
                        window.selectVideo(VIDEO_FILES[newIndex].id);
                    }
                    return;
                }
                
                // Photos folder navigation
                if (state.openFolderId === 'photos') {
                    if (state.galleryViewMode === 'single') {
                        // Single view: left/right to switch photos
                        if (e.key === 'ArrowLeft') {
                            const currentIndex = PHOTO_FILES.findIndex(p => p.id === state.selectedPhotoId);
                            const newIndex = (currentIndex - 1 + PHOTO_FILES.length) % PHOTO_FILES.length;
                            state.slideDirection = 'left';
                            state.selectedPhotoId = PHOTO_FILES[newIndex].id;
                            renderWindow();
                        } else if (e.key === 'ArrowRight') {
                            const currentIndex = PHOTO_FILES.findIndex(p => p.id === state.selectedPhotoId);
                            const newIndex = (currentIndex + 1) % PHOTO_FILES.length;
                            state.slideDirection = 'right';
                            state.selectedPhotoId = PHOTO_FILES[newIndex].id;
                            renderWindow();
                        }
                    } else {
                        // Grid view: all arrow keys to navigate
                        const currentIndex = PHOTO_FILES.findIndex(p => p.id === state.selectedPhotoId);
                        let newIndex = currentIndex;
                        const cols = 6; // Match the grid-cols-6 in getPhotosContent
                        
                        if (e.key === 'ArrowUp') {
                            newIndex = Math.max(0, currentIndex - cols);
                        } else if (e.key === 'ArrowDown') {
                            newIndex = Math.min(PHOTO_FILES.length - 1, currentIndex + cols);
                        } else if (e.key === 'ArrowLeft') {
                            newIndex = (currentIndex - 1 + PHOTO_FILES.length) % PHOTO_FILES.length;
                        } else if (e.key === 'ArrowRight') {
                            newIndex = (currentIndex + 1) % PHOTO_FILES.length;
                        }
                        
                        if (newIndex !== currentIndex) {
                            state.selectedPhotoId = PHOTO_FILES[newIndex].id;
                            renderWindow();
                        }
                    }
                    return;
                }
            }
        });

        // --- INIT ---
        const isMobile = /Mobi|Android|iPhone|iPad|iPod|Opera Mini|BlackBerry|IEMobile|WPDesktop|Tablet|EdgA|CriOS|Firefox/i.test(navigator.userAgent) ||
                             (/macintosh|mac os x/i.test(navigator.userAgent) && navigator.maxTouchPoints && navigator.maxTouchPoints > 1);

        if (isMobile) {
            document.getElementById('mobile-warning').classList.remove('hidden');
            document.getElementById('desktop-layer').classList.add('hidden');
            document.getElementById('footer-layer').classList.add('hidden');
            document.getElementById('ui-layer').classList.add('hidden');
            document.getElementById('window-layer').classList.add('hidden');
        } else {
            // Preload all website images on page load
            preloadAllWebsiteImages();
        render();
        }

    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>